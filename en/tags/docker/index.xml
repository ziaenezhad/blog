<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on Sajjad Shirazi</title><link>https://sajjadshirazi.ir/en/tags/docker/</link><description>Recent content in Docker on Sajjad Shirazi</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 22 Jun 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://sajjadshirazi.ir/en/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>Self hosted Sentry updating TODO list</title><link>https://sajjadshirazi.ir/en/p/self-hosted-sentry-updating-todo-list/</link><pubDate>Wed, 22 Jun 2022 00:00:00 +0000</pubDate><guid>https://sajjadshirazi.ir/en/p/self-hosted-sentry-updating-todo-list/</guid><description>&lt;img src="https://sajjadshirazi.ir/en/p/self-hosted-sentry-updating-todo-list/cover.jpg" alt="Featured image of post Self hosted Sentry updating TODO list" />&lt;p>In addition to making its source code available publicly, &lt;a class="link" href="https://sentry.io/welcome/" target="_blank" rel="noopener"
>Sentry&lt;/a> offers and maintains a minimal setup that works out-of-the-box for simple use cases.&lt;/p>
&lt;p>&lt;a class="link" href="https://sentry.io/welcome/" target="_blank" rel="noopener"
>Sentry&lt;/a> encourage everyone to regularly update their &lt;a class="link" href="https://sentry.io/welcome/" target="_blank" rel="noopener"
>Sentry&lt;/a> installations to get the best and the most recent &lt;a class="link" href="https://sentry.io/welcome/" target="_blank" rel="noopener"
>Sentry&lt;/a> experience.&lt;/p>
&lt;h2 id="create-a-backeupsnapshot">Create a backeup/snapshot&lt;/h2>
&lt;p>Make Sure you have a quickly revertable backup/snapshot.&lt;/p>
&lt;h2 id="download-the-closer-update">Download the closer update&lt;/h2>
&lt;p>You have to update your &lt;a class="link" href="https://sentry.io/welcome/" target="_blank" rel="noopener"
>Sentry&lt;/a> one by one, so you can&amp;rsquo;t upgrade from &lt;code>20.x&lt;/code> to &lt;code>22.x&lt;/code> or some thing.&lt;/p>
&lt;p>Also read the release notes carefully. some times there are more steps before updating to a release:&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/getsentry/self-hosted/releases" target="_blank" rel="noopener"
>https://github.com/getsentry/self-hosted/releases&lt;/a>&lt;/p>
&lt;p>Supposing the next one is &lt;code>21.9.0&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">wget -qO- https://github.com/getsentry/self-hosted/archive/refs/tags/21.9.0.tar.gz &lt;span class="p">|&lt;/span> tar xvz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And go to the directory:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ./self-hosted-21.9.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="copy-the-configenv-files-to-the-new-version-directory">Copy the config/env files to the new version directory&lt;/h2>
&lt;p>These are the config files. It&amp;rsquo;s not bad to compare the old and new config files before moving, to make sure the formats are same.&lt;/p>
&lt;ul>
&lt;li>&lt;code>sentry/config.yml&lt;/code>&lt;/li>
&lt;li>&lt;code>sentry/sentry.conf.py&lt;/code>&lt;/li>
&lt;li>&lt;code>.env&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="run-the-installation-script">Run the installation script&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo bash ./install.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="start-the-services">Start the services&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker-compose up -d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Done ðŸ™‚&lt;/p></description></item><item><title>Dokku Installation TODO list</title><link>https://sajjadshirazi.ir/en/p/dokku-installation-todo-list/</link><pubDate>Sat, 18 Jun 2022 00:00:00 +0000</pubDate><guid>https://sajjadshirazi.ir/en/p/dokku-installation-todo-list/</guid><description>&lt;img src="https://sajjadshirazi.ir/en/p/dokku-installation-todo-list/cover.jpg" alt="Featured image of post Dokku Installation TODO list" />&lt;h2 id="prepare-the-requirements">Prepare the requirements&lt;/h2>
&lt;ul>
&lt;li>At least 1 GB of system memory&lt;/li>
&lt;li>A fresh installation of &lt;code>Ubuntu 18.04/20.04/22.04&lt;/code>&lt;/li>
&lt;li>A domain pointing to the server ip will allow to add git remotes &lt;code>dokku.my-domain.com&lt;/code>.&lt;/li>
&lt;li>A wildcard domain &lt;code>*.dokku.my-domain.com&lt;/code> will allow access to apps via &lt;code>$APP.dokku.my-domain.com&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h2 id="installation">Installation&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/dokku/dokku/v0.27.5/bootstrap.sh&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo &lt;span class="nv">DOKKU_TAG&lt;/span>&lt;span class="o">=&lt;/span>v0.27.5 bash bootstrap.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="post-installation">Post installation&lt;/h2>
&lt;h3 id="allow-authorized-ssh-keys-to-access-dokku-too">Allow authorized ssh keys to access dokku too&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cat ~/.ssh/authorized_keys &lt;span class="p">|&lt;/span> dokku ssh-keys:add admin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="set-global-base-domain">Set global base domain&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku domains:set-global dokku.my-domain.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="letsencrypt-tls-certificates">Letsencrypt TLS certificates&lt;/h2>
&lt;p>&lt;code>dokku-letsencrypt&lt;/code> is the official plugin for dokku that gives the ability to automatically retrieve and install TLS certificates from [letsencrypt.org](&lt;a class="link" href="https://letsencrypt.or" target="_blank" rel="noopener"
>https://letsencrypt.or&lt;/a> During ACME validation, your app will stay available at any time.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="set-global-email">Set global email&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku config:set --global &lt;span class="nv">DOKKU_LETSENCRYPT_EMAIL&lt;/span>&lt;span class="o">=&lt;/span>your@email.tld
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="enable-automatic-certificate-renewal">Enable automatic certificate renewal&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku letsencrypt:cron-job --add
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="postgres-database-setup">Postgres database setup&lt;/h2>
&lt;h3 id="installation-1">Installation&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo dokku plugin:install https://github.com/dokku/dokku-postgres.git postgres
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="creating-the-service">Creating the service&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku postgres:create my-database
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="expose-the-port">Expose the port&lt;/h3>
&lt;p>Expose a postgres service on custom host:port to have access from out world:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku postgres:expose my-database &lt;span class="m">5432&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>You can now find the user/pass/post of the datbase this way:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku postgres:info my-database
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="deployment">Deployment&lt;/h2>
&lt;h3 id="creating-an-app">Creating an app&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku apps:create my-app
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="set-env-variables">Set env variables&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku config:set my-app &lt;span class="nv">JWT_SECRET&lt;/span>&lt;span class="o">=&lt;/span>jwt-secret &lt;span class="nv">JWT_EXPIRES_IN&lt;/span>&lt;span class="o">=&lt;/span>1d &lt;span class="nv">NODE_ENV&lt;/span>&lt;span class="o">=&lt;/span>production ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="link-postgres-database-to-the-app">Link postgres database to the app&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku postgres:link my-database my-app
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This will add the proper &lt;code>DATABASE_URL&lt;/code> to the env variables of &lt;code>my-app&lt;/code>.&lt;/p>
&lt;h3 id="add-a-git-remote">Add a git remote&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git remote add dokku dokku@dokku.may-domain.com:my-app
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="push-to-dokku">Push to Dokku&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git push dokku
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="set-the-proxy-port-for-the-dockerised-apps">Set the proxy port (for the Dockerised apps)&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku proxy:ports-add my-app http:80:3000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="enable-letsencrypt">Enable Letsencrypt&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dokku letsencrypt:enable my-app
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Done ðŸ™‚&lt;/p></description></item></channel></rss>